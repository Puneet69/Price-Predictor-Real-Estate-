#!/bin/bash

# ğŸš€ RAILWAY MONOREPO DEPLOYMENT FIX

clear
echo "ğŸ”§ RAILWAY DEPLOYMENT FIX - MONOREPO ISSUE"
echo "=========================================="
echo ""
echo "âŒ PROBLEM IDENTIFIED:"
echo "Railway's Nixpacks failed because it saw both frontend/ and backend/"
echo "directories and couldn't determine what to build."
echo ""
echo "âœ… SOLUTION:"
echo "Deploy backend and frontend as separate services with root directories."
echo ""
echo "ğŸš€ FOLLOW THESE EXACT STEPS:"
echo ""

echo "1ï¸âƒ£  DELETE FAILED SERVICE:"
echo "   ğŸ‘‰ In Railway dashboard, click on failed service"
echo "   ğŸ‘‰ Go to 'Settings' tab (at bottom)"
echo "   ğŸ‘‰ Click 'Delete Service'"
echo "   ğŸ‘‰ Confirm deletion"
echo ""

echo "2ï¸âƒ£  DEPLOY BACKEND SERVICE:"
echo "   ğŸ‘‰ Click 'New Service' in Railway"
echo "   ğŸ‘‰ Select 'GitHub Repo'"
echo "   ğŸ‘‰ Choose: Puneet69/Price-Predictor-Real-Estate-"
echo "   ğŸ‘‰ âš ï¸  IMPORTANT: Look for 'Root Directory' or 'Source Path'"
echo "   ğŸ‘‰ Set Root Directory to: backend"
echo "   ğŸ‘‰ Click 'Deploy'"
echo ""

echo "3ï¸âƒ£  ADD MONGODB ENVIRONMENT VARIABLE:"
echo "   ğŸ‘‰ While backend builds, go to 'Variables' tab"
echo "   ğŸ‘‰ Add variable:"
echo "       Name: MONGODB_URI"
echo "       Value: mongodb+srv://price_predictor:vlMUA2FIr48bnJWO@realestate.caqfzde.mongodb.net/property_comparison?retryWrites=true&w=majority&appName=RealEstate"
echo ""

echo "4ï¸âƒ£  DEPLOY FRONTEND SERVICE:"
echo "   ğŸ‘‰ In same project, click 'New Service'"
echo "   ğŸ‘‰ Select 'GitHub Repo'"
echo "   ğŸ‘‰ Choose same repo: Puneet69/Price-Predictor-Real-Estate-"
echo "   ğŸ‘‰ âš ï¸  IMPORTANT: Set Root Directory to: frontend"
echo "   ğŸ‘‰ Click 'Deploy'"
echo ""

echo "5ï¸âƒ£  CONNECT FRONTEND TO BACKEND:"
echo "   ğŸ‘‰ Wait for backend to get a URL"
echo "   ğŸ‘‰ Copy backend URL (like: https://backend-production-xxxx.up.railway.app)"
echo "   ğŸ‘‰ Go to frontend service â†’ Variables tab"
echo "   ğŸ‘‰ Add variable:"
echo "       Name: REACT_APP_API_URL"
echo "       Value: [Your backend URL]"
echo ""

echo "ğŸ¯ EXPECTED RESULTS:"
echo "âœ… Backend builds successfully (2-3 minutes)"
echo "âœ… Frontend builds successfully (3-5 minutes)"
echo "âœ… Both services show 'Active' status"
echo "âœ… You get two working URLs"
echo ""

echo "ğŸ§ª TEST YOUR FIXED DEPLOYMENT:"
echo "1. Visit backend URL + /docs (should show FastAPI documentation)"
echo "2. Visit frontend URL (should show your React app)"
echo "3. Test property comparison functionality"
echo ""

echo "ğŸ’¡ WHY THIS FIXES THE ISSUE:"
echo "Railway's Nixpacks now knows exactly what to build:"
echo "- Backend service only sees backend/ directory"
echo "- Frontend service only sees frontend/ directory"
echo "- No more confusion about what to build!"
echo ""

echo "ğŸ†˜ IF ROOT DIRECTORY OPTION NOT VISIBLE:"
echo "1. Deploy service first"
echo "2. Go to service Settings"
echo "3. Change 'Source Path' to backend or frontend"
echo "4. Redeploy"
echo ""

echo "ğŸš€ ALTERNATIVE QUICK FIX:"
echo "If Railway keeps having issues, try Render.com:"
echo "- Create Web Service (backend) with root: backend"
echo "- Create Static Site (frontend) with root: frontend"
echo "- Same GitHub repo, same environment variables"
echo ""

echo "=========================================="
echo "ğŸ¯ SUMMARY: Delete failed service, create two new services"
echo "with proper root directories (backend/ and frontend/)"
echo "=========================================="